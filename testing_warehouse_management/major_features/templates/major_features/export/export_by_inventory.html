{% extends "major_features/layout.html" %}

{% block nav %}

<nav class="navbar navbar-expand-lg navbar-light" style="background-color: #01257D;">
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item" style="padding: 2.5px 5px 2.5px 5px;">
          <a class="nav-link" style="color: white;" href="{% url 'index' %}">Trang chủ</a>
        </li>
        <li class="nav-item dropdown-trigger" style="padding: 2.5px 5px 2.5px 5px;">
          <a class="nav-link" style="color: white;" href="{% url 'import_shipments' %}">Nhập kho</a>
          <ul class="dropdown-ul">
            <li class="nav-item dropdown-li">
              <a class="nav-link" href="{% url 'import_shipments' %}" style="color: white; text-decoration: none;">
                Theo dõi lô hàng nhập kho
              </a>
            </li>
            <li class="nav-item dropdown-li">
              <a class="nav-link" href="{% url 'import_action' %}" style="color: white; text-decoration: none;">
                Thực hiện nhập kho
              </a>
            </li>
          </ul>
        </li>
        <li class="nav-item dropdown-trigger" style="padding: 2.5px 5px 2.5px 5px;">
          <a class="nav-link" style="color: #00FFFF; border-bottom: 2px solid #00FFFF;" href="{% url 'export_shipments' %}">Xuất kho</a>
          <ul class="dropdown-ul">
            <li class="nav-item dropdown-li">
              <a class="nav-link" href="{% url 'export_shipments' %}" style="color: white; text-decoration: none;">
                Theo dõi lô hàng xuất kho
              </a>
            </li>
            <li class="nav-item dropdown-li">
              <a class="nav-link" href="{% url 'export_action' %}" style="color: white; text-decoration: none;">
                Thực hiện xuất kho
              </a>
            </li>
          </ul>
        </li>
        <li class="nav-item" style="padding: 2.5px 5px 2.5px 5px;">
          <a class="nav-link" style="color: white;" href="{% url 'reports' %}">Thống kê</a>
        </li>
      </ul>
    </div>
  </nav>

{% endblock %}

{% block title %}

    {% if starting_inventory_form %}
    <h4>Chọn đơn hàng nhập kho để tiến hành xuất kho từ <strong>Hàng tồn kho đầu kỳ</strong></h4>
    {% else %}
    <h4>Chọn đơn hàng nhập kho để tiến hành xuất kho từ <strong>Hàng tồn kho phát sinh trong kỳ</strong></h4>
    {% endif %}

{% endblock %}

{% block body %}

<table>
  <tr>
    {% if filter_context %}
    <td>
      <ul>
        <strong>Lọc theo: </strong>
        
        {% if filter_context.import_shipment %}
        <li>Mã lô hàng nhập kho: {{ filter_context.import_shipment }}</li>
        {% endif %}

        {% if filter_context.quantity_remain_greater_than > 0 %}
        <li>SLCL lớn hơn: {{ filter_context.quantity_remain_greater_than }}</li>
        {% endif %}

        {% if filter_context.quantity_remain_less_than > 0 %}
        <li>SLCL nhỏ hơn: {{ filter_context.quantity_remain_less_than }}</li>
        {% endif %}

        {% if filter_context.import_cost_greater_than > 0 %}
        <li>Đơn giá nhập kho lớn hơn: {{ filter_context.import_cost_greater_than }}</li>
        {% endif %}

        {% if filter_context.import_cost_less_than > 0 %}
        <li>Đơn giá nhập kho nhỏ hơn: {{ filter_context.import_cost_less_than }}</li>
        {% endif %}
      </ul>
    </td>
    {% endif %}

    {% if quantity_take_context %}
    <td>
      <p><strong>Tổng sản phẩm xuất kho theo đơn hàng {{ export_order_id }}</strong>: {{ quantity_take_context.quantity_export }}</p>
      {% if quantity_take_context.total_quantity_take %}
      <p><strong>Tổng sản phẩm đã xuất kho theo đơn hàng {{ export_order_id }}</strong>: {{ quantity_take_context.total_quantity_take }}</p>
      {% endif %}
      {% if quantity_take_context.quantity_remain %}
      <p><strong>Tổng sản phẩm còn lại theo đơn hàng {{ export_order_id }}</strong>: {{ quantity_take_context.quantity_remain }}</p>
      {% endif %}
    </td>
    {% endif %}
  </tr>
</table>

<div class="container d-flex justify-content-center">
  <div class="form-container">
    <form action="{% url 'actual_method_by_name_export_action' export_order_id product type %}" method="get">
      {% csrf_token %}

      {% if starting_inventory_form %}
      <fieldset>
        <legend>Lọc đơn hàng nhập kho thuộc nhóm hàng tồn kho đầu kỳ theo: </legend>
        <div style="display: flex; justify-content: center;">
          <div style="margin-left: 10px; margin-right: 10px;">
            {{ filtering_starting_inventory_form.import_shipments.label_tag }}
            {{ filtering_starting_inventory_form.import_shipments }}
            {% if filtering_starting_inventory_form.import_shipments.errors %}
            <ul>
              {% for error in filtering_starting_inventory_form.import_shipments.errors %}
                <li style="color: red;">{{ error }}</li>
              {% endfor %}
            </ul>
            {% endif %}
          </div>
        
          <div style="display: flex; justify-content: center;">
            <div style="margin-left: 10px; margin-right: 10px;">
              {{ filtering_starting_inventory_form.quantity_remain_greater_than.label_tag }}
              {{ filtering_starting_inventory_form.quantity_remain_greater_than }}
              {% if filtering_starting_inventory_form.quantity_remain_greater_than.errors %}
              <ul>
                {% for error in filtering_starting_inventory_form.quantity_remain_greater_than.errors %}
                  <li style="color: red;">{{ error }}</li>
                {% endfor %}
              </ul>
              {% endif %}
            </div>
          
            <div style="margin-left: 10px; margin-right: 10px;">
              {{ filtering_starting_inventory_form.quantity_remain_less_than.label_tag }}
              {{ filtering_starting_inventory_form.quantity_remain_less_than }}
              {% if filtering_starting_inventory_form.quantity_remain_less_than.errors %}
              <ul>
                {% for error in filtering_starting_inventory_form.quantity_remain_less_than.errors %}
                  <li style="color: red;">{{ error }}</li>
                {% endfor %}
              </ul>
              {% endif %}
            </div>
          </div>
        
          <div style="display: flex; justify-content: center;">
            <div style="margin-left: 10px; margin-right: 10px;">
              {{ filtering_starting_inventory_form.import_cost_greater_than.label_tag }}
              {{ filtering_starting_inventory_form.import_cost_greater_than }}
              {% if filtering_starting_inventory_form.import_cost_greater_than.errors %}
                <ul>
                  {% for error in filtering_starting_inventory_form.import_cost_greater_than.errors %}
                    <li style="color: red;">{{ error }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>
          
            <div style="margin-left: 10px; margin-right: 10px;">
              {{ filtering_starting_inventory_form.import_cost_less_than.label_tag }}
              {{ filtering_starting_inventory_form.import_cost_less_than }}
              {% if filtering_starting_inventory_form.import_cost_less_than.errors %}
                <ul>
                  {% for error in filtering_starting_inventory_form.import_cost_less_than.errors %}
                    <li style="color: red;">{{ error }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>
          </div>

        </div>
      </fieldset>

      {% else %}
      <fieldset>
        <legend>Lọc đơn hàng nhập kho thuộc nhóm hàng tồn kho phát sinh trong kỳ theo: </legend>
        <div style="display: flex; justify-content: center;">
          <div style="margin-left: 10px; margin-right: 10px;">
            {{ filtering_current_accounting_period_inventory_form.import_shipments.label_tag }}
            {{ filtering_current_accounting_period_inventory_form.import_shipments }}
            {% if filtering_current_accounting_period_inventory_form.import_shipments.errors %}
            <ul>
              {% for error in filtering_current_accounting_period_inventory_form.import_shipments.errors %}
                <li style="color: red;">{{ error }}</li>
              {% endfor %}
            </ul>
            {% endif %}
          </div>
        
          <div style="display: flex; justify-content: center;">
            <div style="margin-left: 10px; margin-right: 10px;">
              {{ filtering_current_accounting_period_inventory_form.quantity_remain_greater_than.label_tag }}
              {{ filtering_current_accounting_period_inventory_form.quantity_remain_greater_than }}
              {% if filtering_current_accounting_period_inventory_form.quantity_remain_greater_than.errors %}
              <ul>
                {% for error in filtering_current_accounting_period_inventory_form.quantity_remain_greater_than.errors %}
                  <li style="color: red;">{{ error }}</li>
                {% endfor %}
              </ul>
              {% endif %}
            </div>
          
            <div style="margin-left: 10px; margin-right: 10px;">
              {{ filtering_current_accounting_period_inventory_form.quantity_remain_less_than.label_tag }}
              {{ filtering_current_accounting_period_inventory_form.quantity_remain_less_than }}
              {% if filtering_current_accounting_period_inventory_form.quantity_remain_less_than.errors %}
              <ul>
                {% for error in filtering_current_accounting_period_inventory_form.quantity_remain_less_than.errors %}
                  <li style="color: red;">{{ error }}</li>
                {% endfor %}
              </ul>
              {% endif %}
            </div>
          </div>
        
          <div style="display: flex; justify-content: center;">
            <div style="margin-left: 10px; margin-right: 10px;">
              {{ filtering_current_accounting_period_inventory_form.import_cost_greater_than.label_tag }}
              {{ filtering_current_accounting_period_inventory_form.import_cost_greater_than }}
              {% if filtering_current_accounting_period_inventory_form.import_cost_greater_than.errors %}
                <ul>
                  {% for error in filtering_current_accounting_period_inventory_form.import_cost_greater_than.errors %}
                    <li style="color: red;">{{ error }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>
          
            <div style="margin-left: 10px; margin-right: 10px;">
              {{ filtering_current_accounting_period_inventory_form.import_cost_less_than.label_tag }}
              {{ filtering_current_accounting_period_inventory_form.import_cost_less_than }}
              {% if filtering_current_accounting_period_inventory_form.import_cost_less_than.errors %}
                <ul>
                  {% for error in filtering_current_accounting_period_inventory_form.import_cost_less_than.errors %}
                    <li style="color: red;">{{ error }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>
          </div>

        </div>
      </fieldset>
      {% endif %}
    <button type="submit" class="submit-button">Tiến hành lọc</button>
    </form>
  </div>
</div>

<div class="container d-flex justify-content-center" style="margin-top: 20px;">
    <div class="form-container">
        <form action="{% url 'actual_method_by_name_export_action' export_order_id product type %}" method="post" class="shipment-form">
            {% csrf_token %}
            <fieldset>

                {% if starting_inventory_form %}
                <legend>Tiến hành chọn đơn hàng nhập kho từ Hàng tồn kho đầu kỳ: </legend>
                {{ starting_inventory_form.as_p }}

                {% else %}
                <legend>Tiến hành chọn đơn hàng nhập kho từ Hàng tồn kho phát sinh trong kỳ: </legend>
                {{ current_accounting_period_inventory_form.as_p }}

                {% endif %}
                
                <button type="submit" class="submit-button" name="save_and_continue">Lưu và tiếp tục</button>
                <button type="submit" class="submit-button" name="save_and_complete">Lưu và hoàn tất</button>

            </fieldset>
        </form>
    </div>
</div>

{% endblock %}