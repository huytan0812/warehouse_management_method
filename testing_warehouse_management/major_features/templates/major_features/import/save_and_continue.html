{% extends "major_features/layout.html" %}

{% load humanize %}
{% load custom_filters %}

{% block nav %}
<nav class="navbar navbar-expand-lg navbar-light" style="background-color: #01257D;">
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item" style="padding: 2.5px 5px 2.5px 5px;">
        <a class="nav-link" style="color: white;" href="{% url 'index' %}">Trang chủ</a>
      </li>
      <li class="nav-item dropdown-trigger" style="padding: 2.5px 5px 2.5px 5px;">
        <a class="nav-link" style="color: #00FFFF; border-bottom: 2px solid #00FFFF;" href="{% url 'import_shipments' %}">Nhập kho</a>
        <ul class="dropdown-ul">
          <li class="nav-item dropdown-li">
            <a class="nav-link" href="{% url 'import_shipments' %}" style="color: white; text-decoration: none;">
              Theo dõi lô hàng nhập kho
            </a>
          </li>
          <li class="nav-item dropdown-li">
            <a class="nav-link" href="{% url 'import_action' %}" style="color: white; text-decoration: none;">
              Thực hiện nhập kho
            </a>
          </li>
        </ul>
      </li>
      <li class="nav-item dropdown-trigger" style="padding: 2.5px 5px 2.5px 5px;">
        <a class="nav-link" style="color: white;" href="{% url 'export_shipments' %}">Xuất kho</a>
        <ul class="dropdown-ul">
          <li class="nav-item dropdown-li">
            <a class="nav-link" href="{% url 'export_shipments' %}" style="color: white; text-decoration: none;">
              Theo dõi lô hàng xuất kho
            </a>
          </li>
          <li class="nav-item dropdown-li">
            <a class="nav-link" href="{% url 'export_action' %}" style="color: white; text-decoration: none;">
              Thực hiện xuất kho
            </a>
          </li>
        </ul>
      </li>
      <li class="nav-item" style="padding: 2.5px 5px 2.5px 5px;">
        <a class="nav-link" style="color: white;" href="{% url 'reports' %}">Thống kê</a>
      </li>
    </ul>
  </div>
</nav>
{% endblock %}

{% block title %}
<h2>Trang nhập kho</h2>
{% endblock %}

{% block body %}
<h3>Tiếp tục nhập thêm đơn hàng cho lô hàng {{ import_shipment_code }}</h3>

<div id="import-shipment-container">
    <p>Mã lô hàng: <strong>{{ import_shipment_code }}</strong></p>
    <p>Nhà cung cấp lô hàng: <strong>{{ import_shipment_supplier }}</strong></p>
    <p>Ngày nhập lô hàng: <strong>{{ import_shipment_date }}</strong></p>
</div>

<div id="import-shipment-purchases">
    <table class="table table-bordered table-striped table-dark w-auto" style="margin: auto;">
        <thead>
          <tr>
            <th scope="col">Sản phẩm</th>
            <th scope="col">Số lượng nhập kho</th>
            <th scope="col">Đơn giá nhập kho</th>
            <th scope="col">Giá trị</th>
            <th scope="col">Thực hiện</th>
          </tr>
        </thead>
        <tbody>
          {% for import_purchase in import_shipment_purchases %}
          <tr>
            <td>{{ import_purchase.product_id.name }}</td>
            <td>{{ import_purchase.quantity_import }}</td>
            <td>{{ import_purchase.import_cost }}</td>
            <td>{{ import_purchase.quantity_import|multiply:import_purchase.import_cost|intcomma }}</td>
            <td>
              <a href="{% url 'import_purchase_update' import_purchase.id %}">Sửa</a> / 
              <a href="{% url 'import_purchase_delete' import_purchase.id %}">Xóa</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
</div>

<div id="purchase-additional-information">
  {% for purchase, value_container in purchase_additional_fields.items %}
  <p><strong>{{ purchase }}: </strong>
    Số lượng nhập kho trong lô hàng trên <strong>{{ value_container.purchase_quantity_import|intcomma }}</strong>
    Giá trị nhập kho trong lô hàng trên <strong>{{ value_container.purchase_value|intcomma }}</strong>
  </p>
  {% endfor %}
</div>

<div class="container d-flex justify-content-center">
  <div class="form-container">
    <form action="{% url 'save_and_continue' import_shipment_code %}" method="post" class="shipment-form">
        {% csrf_token %}

        <div class="form-group">

          <fieldset>
            <legend>
                <strong>Nhập kho sản phẩm:</strong>
            </legend>
            {{ import_purchase_form.as_p }}
          </fieldset>

        </div>

        <button type="submit" name="save_and_continue" class="submit-button">Lưu và tiếp tục nhập kho sản phẩm theo lô hàng trên</button>
        <button type="submit" name="save_and_complete" class="submit-button">Lưu và hoàn tất</button>

    </form>
  </div>
</div>

<a href="{% url 'save_and_complete' import_shipment_code %}">Hoàn tất việc nhập kho lô hàng</a>
{% endblock %}